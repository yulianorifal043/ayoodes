<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layanan Langsung Kantor - Admin Desa Digital</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB', 
                        secondary: '#F0F9FF', 
                    },
                },
            },
        }
    </script>
    
    <!-- Load Custom Styles (untuk layout sidebar) -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="antialiased bg-gray-100 min-h-screen">

    <!-- Notification Container -->
    <div id="notification-container" class="fixed right-4 top-4 z-50 space-y-2"></div>

    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition duration-300 ease-in-out bg-gray-800 w-64 z-50 shadow-2xl">
        <div class="p-6">
            <a href="dashboard.html" class="flex items-center space-x-3 text-white">
                <img src="assets/images/logo-desa.png" alt="Logo Desa" class="w-8 h-8">
                <span class="text-xl font-extrabold">Admin Desa</span>
            </a>
        </div>
        <nav class="mt-8 space-y-2 px-4">
            <a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded-xl text-gray-400 hover:bg-gray-700 hover:text-white transition duration-150">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span>Dashboard Utama</span>
            </a>
            <a href="dashboard_kk_admin.html" class="flex items-center space-x-3 p-3 rounded-xl text-gray-400 hover:bg-gray-700 hover:text-white transition duration-150">
                <i data-lucide="users-round" class="w-5 h-5"></i>
                <span>Data Kartu Keluarga</span>
            </a>
            <a href="manajemen_layanan.html" class="flex items-center space-x-3 p-3 rounded-xl text-gray-400 hover:bg-gray-700 hover:text-white transition duration-150">
                <i data-lucide="scroll-text" class="w-5 h-5"></i>
                <span>Manajemen Pengajuan</span>
            </a>
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-700">
            <a href="index.html" class="flex items-center space-x-3 p-3 rounded-xl text-red-400 hover:bg-gray-700 transition duration-150">
                <i data-lucide="log-out" class="w-5 h-5"></i>
                <span>Kembali ke Publik</span>
            </a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="md:ml-64 transition-all duration-300 min-h-screen">
        
        <!-- Top Bar Header -->
        <header class="bg-white shadow-sm p-4 sticky top-0 z-30">
            <div class="flex justify-between items-center">
                <button id="sidebar-toggle" class="md:hidden p-2 rounded-lg text-gray-700 hover:bg-gray-100">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h1 class="text-xl sm:text-2xl font-bold text-gray-800">Pelayanan Langsung Kantor</h1>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600 hidden sm:block">Petugas: [Nama Petugas]</span>
                    <i data-lucide="user-circle" class="w-7 h-7 text-gray-500"></i>
                </div>
            </div>
        </header>

        <!-- Content Body -->
        <main class="p-4 sm:p-6">
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-3">Formulir Pelayanan Mandiri (Admin Input)</h2>
                
                <form id="office-service-form" class="space-y-6">
                    <!-- Tahap 1: Verifikasi NIK -->
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-200 space-y-3">
                        <h3 class="font-bold text-lg text-primary flex items-center"><i data-lucide="user-check" class="w-5 h-5 mr-2"></i> 1. Data Pemohon (NIK)</h3>
                        
                        <label for="nik-pemohon" class="block font-medium text-gray-700">NIK Pemohon (Wajib diisi):</label>
                        <input type="number" id="nik-pemohon" class="w-full border-gray-300 rounded-xl shadow-sm" placeholder="Masukkan 16 digit NIK">
                        
                        <button type="button" onclick="checkNIKOffice()" class="bg-primary text-white px-4 py-2 rounded-xl font-semibold hover:bg-blue-700 transition duration-150 w-full">
                            Verifikasi NIK & Lanjutkan
                        </button>
                    </div>

                    <!-- Tahap 2: Input Data Dasar & Sensus Mandiri (Tampil setelah NIK dicek) -->
                    <div id="data-input-stage" class="hidden space-y-4">
                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 space-y-3">
                            <h3 class="font-bold text-lg text-yellow-800 flex items-center"><i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i> Status Data NIK: <span id="nik-status-message"></span></h3>
                            <p class="text-sm text-yellow-700 font-medium">Lanjutkan pengisian data dasar kependudukan untuk kelengkapan sensus desa:</p>
                        </div>
                        
                        <h3 class="font-bold text-lg text-gray-800 border-b pb-2">2. Data Pemohon & Sensus Dasar</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700">Nama Lengkap</label>
                                <input type="text" id="input-nama" class="w-full border-gray-300 rounded-xl shadow-sm">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700">Jenis Kelamin</label>
                                <select id="input-jk" class="w-full border-gray-300 rounded-xl shadow-sm">
                                    <option value="">Pilih</option>
                                    <option value="Laki-laki">Laki-laki</option>
                                    <option value="Perempuan">Perempuan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700">Pekerjaan</label>
                                <input type="text" id="input-pekerjaan" class="w-full border-gray-300 rounded-xl shadow-sm">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700">Alamat (RT/RW)</label>
                                <input type="text" id="input-alamat" class="w-full border-gray-300 rounded-xl shadow-sm" placeholder="Contoh: 001/003">
                            </div>
                        </div>

                        <h3 class="font-bold text-lg text-gray-800 border-b pb-2 pt-4">3. Pilih Layanan</h3>
                        
                        <div>
                            <label class="block font-medium text-gray-700">Pilih Jenis Layanan yang Diajukan</label>
                            <select id="select-layanan" class="w-full border-gray-300 rounded-xl shadow-sm">
                                <option value="">--- Pilih Layanan ---</option>
                                <option value="KTP">Pengajuan KTP Baru</option>
                                <option value="Usaha">Surat Izin Usaha</option>
                                <option value="Lainnya">Surat Pengantar Lainnya</option>
                            </select>
                        </div>
                        
                        <div id="syarat-display" class="bg-gray-50 p-3 rounded-xl border border-gray-200">
                             <h4 class="font-bold text-gray-800 mb-2">Syarat Ketentuan:</h4>
                            <ul id="syarat-list" class="list-disc list-inside text-sm text-gray-700 pl-4">
                                <!-- Syarat dimuat dari Template Layanan -->
                                <li>Pilih layanan di atas untuk melihat syarat.</li>
                            </ul>
                        </div>

                        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-xl font-semibold hover:bg-green-700 transition duration-150 w-full mt-6">
                            Proses Layanan & Cetak (Simulasi)
                        </button>
                    </div>

                </form>
            </div>
        </main>
    </div>

    <!-- Custom Script untuk Halaman Pelayanan Kantor -->
    <script>
        // --- FUNGSI CORE ADMIN (Diulang untuk menjamin fungsi di Canvas) ---
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const colorMap = {
                'success': 'bg-green-500', 'error': 'bg-red-500', 'warning': 'bg-yellow-500', 'info': 'bg-primary'
            };
            const iconMap = {
                'success': 'check-circle', 'error': 'alert-triangle', 'warning': 'alert-circle', 'info': 'info'
            };

            const notification = document.createElement('div');
            notification.className = `p-4 rounded-xl shadow-lg text-white ${colorMap[type]} transition-all duration-300 transform translate-x-full opacity-0`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="${iconMap[type]}" class="w-5 h-5 mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full', 'opacity-0');
                notification.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-0', 'opacity-100');
                notification.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
            
            if (typeof lucide !== 'undefined') { lucide.createIcons(); }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlayId = 'sidebar-overlay';
            let overlay = document.getElementById(overlayId);

            sidebar.classList.toggle('-translate-x-full'); 
            sidebar.classList.toggle('translate-x-0');   
            
            if (sidebar.classList.contains('translate-x-0')) {
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = overlayId;
                    overlay.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-40 md:hidden'; 
                    overlay.onclick = toggleSidebar; 
                    document.body.appendChild(overlay);
                }
            } else {
                if (overlay) {
                    overlay.remove();
                }
            }
        }
        window.toggleSidebar = toggleSidebar;
        // --- AKHIR FUNGSI CORE ADMIN ---

        // DATA MOCK UNTUK SIMULASI TEMPLATE DAN KK
        const mockTemplates = [
            { id: 'KTP', nama: "Pengajuan KTP Baru", syarat: ["KK Lama", "Akta Lahir"], template: "Template KTP Baru..." },
            { id: 'Usaha', nama: "Surat Izin Usaha", syarat: ["Foto Lokasi", "KTP", "Surat Pengantar RT"], template: "Template Surat Izin Usaha..." },
            { id: 'Lainnya', nama: "Surat Pengantar Lainnya", syarat: ["KTP", "KK"], template: "Template Surat Pengantar Lainnya..." },
        ];
        
        const mockKK = ["3301011205800001", "3301011205800002", "3301011205800003"]; // NIK yang valid
        
        // FUNGSI INTI PELAYANAN KANTOR
        
        function checkNIKOffice() {
            const nikInput = document.getElementById('nik-pemohon');
            const nik = nikInput.value.trim();
            const dataStage = document.getElementById('data-input-stage');
            const statusMessage = document.getElementById('nik-status-message');
            
            if (nik.length !== 16) {
                showNotification('NIK harus terdiri dari 16 digit.', 'warning');
                return;
            }

            const isRegistered = mockKK.includes(nik);
            
            if (isRegistered) {
                // NIK VALID: Langsung buka form
                statusMessage.textContent = 'Terdaftar dan Valid';
                dataStage.classList.remove('hidden');
                showNotification(`NIK ${nik} terdeteksi, data dasar dimuat. Lanjutkan layanan.`, 'success');
            } else {
                // NIK TIDAK VALID: Muncul peringatan, tapi tetap bisa lanjut
                statusMessage.textContent = 'Tidak Terdaftar / Tidak Valid';
                dataStage.classList.remove('hidden');
                showNotification(`PERINGATAN: NIK ${nik} tidak terdaftar. Lanjutkan dengan Sensus Data Mandiri.`, 'warning');
            }
        }

        function updateSyaratDisplay() {
            const selectedId = document.getElementById('select-layanan').value;
            const syaratList = document.getElementById('syarat-list');
            syaratList.innerHTML = '';
            
            const template = mockTemplates.find(t => t.id === selectedId);
            
            if (template) {
                template.syarat.forEach(syarat => {
                    syaratList.innerHTML += `<li>${syarat}</li>`;
                });
            } else {
                 syaratList.innerHTML = '<li>Silakan pilih jenis layanan di atas.</li>';
            }
        }

        // FUNGSI SUBMIT
        document.getElementById('office-service-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nik = document.getElementById('nik-pemohon').value.trim();
            const nama = document.getElementById('input-nama').value.trim();
            const layanan = document.getElementById('select-layanan').value;

            if (!nama || !layanan) {
                 showNotification('Nama Lengkap dan Jenis Layanan wajib diisi.', 'error');
                 return;
            }

            // SIMULASI PROSES
            showNotification(`Layanan ${layanan} untuk ${nama} sedang diproses...`, 'info');
            
            // Logika Sensus Mandiri (jika NIK tidak valid)
            const isRegistered = mockKK.includes(nik);
            if (!isRegistered) {
                showNotification('Data sensus mandiri (Nama, Pekerjaan, dll.) berhasil dicatat petugas.', 'warning');
            }
            
            // Simulasi Pembuatan Surat
            const template = mockTemplates.find(t => t.id === layanan);
            if (template) {
                showNotification('Surat berhasil dibuat otomatis. Petugas siap cetak!', 'success');
                // Di sini Anda bisa memanggil previewSurat() jika ada di halaman ini
            }
            
            // Reset Form setelah 3 detik
            setTimeout(() => {
                this.reset();
                document.getElementById('data-input-stage').classList.add('hidden');
                showNotification('Layanan selesai dan formulir direset.', 'info');
            }, 3000);
        });

        // FUNGSI INITIATION
        document.addEventListener('DOMContentLoaded', () => {
            const sidebarToggle = document.getElementById('sidebar-toggle');
            if (sidebarToggle) { sidebarToggle.addEventListener('click', toggleSidebar); }
            document.querySelectorAll('#sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) { toggleSidebar(); }
                });
            });

            document.getElementById('select-layanan').addEventListener('change', updateSyaratDisplay);
            if (typeof lucide !== 'undefined') { lucide.createIcons(); }
            showNotification('Mode Layanan Langsung Kantor siap.', 'success');
        });

    </script>

    <!-- Load Admin Core Script (untuk showNotification, tapi sudah diulang di atas) -->
    <script src="assets/js/admin_core.js"></script>
</body>
</html>
